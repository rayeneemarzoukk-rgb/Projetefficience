# ğŸ¨ Diagrammes: Architecture N8N + Efficience

## 1ï¸âƒ£ Architecture GÃ©nÃ©rale

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        UTILISATEUR                              â”‚
â”‚                                                                  â”‚
â”‚  1. AccÃ¨de Ã  /admin                                             â”‚
â”‚  2. Voit le bouton "Synchroniser"                              â”‚
â”‚  3. Clique le bouton                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ POST /api/admin/trigger-sync
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              EFFICIENCE BACKEND (Next.js)                       â”‚
â”‚                                                                  â”‚
â”‚  1. ReÃ§oit action: "manual-sync"                               â”‚
â”‚  2. Valide token d'authentification                            â”‚
â”‚  3. DÃ©clenche N8N via webhook (optionnel)                      â”‚
â”‚  4. Retourne "Synchronisation dÃ©clenchÃ©e"                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ POST /webhook/efficience-sync
                 â”‚ (si N8N trigger URL configurÃ©e)
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      N8N WORKFLOW                               â”‚
â”‚                                                                  â”‚
â”‚  [Webhook] â†’ [Code Validation] â†’ [IF Check] â†’ [HTTP Request]  â”‚
â”‚     â†“                                              â†“             â”‚
â”‚  ReÃ§oit                                      Envoie donnÃ©es     â”‚
â”‚  requÃªte                                     validÃ©es           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ POST /api/admin/webhook-n8n
                 â”‚ (DonnÃ©es validÃ©es par N8N)
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        EFFICIENCE WEBHOOK HANDLER                               â”‚
â”‚                                                                  â”‚
â”‚  1. Valide token Authorization Bearer                          â”‚
â”‚  2. Mappe type de donnÃ©es (patients, finances, etc)           â”‚
â”‚  3. Formate les donnÃ©es                                        â”‚
â”‚  4. InsÃ¨re dans MongoDB (batch insert)                         â”‚
â”‚  5. Log dans webhook_logs (audit)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ insertMany([...])
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MONGODB DATABASE                              â”‚
â”‚                                                                  â”‚
â”‚  Collections:                                                   â”‚
â”‚  - patients (nom, email, tel)                                 â”‚
â”‚  - donnees_cabinet (CA, finances)                             â”‚
â”‚  - production (heures, actes, praticiens)                     â”‚
â”‚  - rendezvous (date, heure, type)                             â”‚
â”‚  - webhook_logs (audit trail)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ Data persisted
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           EFFICIENCE DASHBOARD (React)                          â”‚
â”‚                                                                  â”‚
â”‚  1. Polling toutes les 10 secondes                            â”‚
â”‚  2. Fetch /api/admin/recent-imports                           â”‚
â”‚  3. Affiche mises Ã  jour dans banner                          â”‚
â”‚  4. RafraÃ®chit graphiques et KPIs                             â”‚
â”‚  5. Admin voit donnÃ©es Ã  jour âœ¨                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2ï¸âƒ£ Flux N8N DÃ©taillÃ©

```
START
  â”‚
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NODE 1: WEBHOOK TRIGGER             â”‚
â”‚                                      â”‚
â”‚  ReÃ§oit POST request                 â”‚
â”‚  Path: /webhook/efficience-sync      â”‚
â”‚  Body: {type, data, cabinetId}      â”‚
â”‚                                      â”‚
â”‚  Output:                             â”‚
â”‚  {                                   â”‚
â”‚    type: "patients",                 â”‚
â”‚    data: [{...}, {...}],             â”‚
â”‚    cabinetId: "cab_1"                â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NODE 2: CODE - VALIDATE DATA        â”‚
â”‚                                      â”‚
â”‚  VÃ©rifie:                            â”‚
â”‚  âœ… Type de donnÃ©es valide          â”‚
â”‚  âœ… Colonnes requises prÃ©sentes     â”‚
â”‚  âœ… Pas de valeurs vides            â”‚
â”‚  âœ… Format correct                  â”‚
â”‚                                      â”‚
â”‚  Output:                             â”‚
â”‚  {                                   â”‚
â”‚    validData: [{...}],               â”‚
â”‚    validCount: 3,                    â”‚
â”‚    discardedCount: 0                 â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NODE 3: IF - VALIDATION CHECK       â”‚
â”‚                                      â”‚
â”‚  Condition: validCount > 0           â”‚
â”‚                                      â”‚
â”‚  IF TRUE â†’ Continue to Node 4        â”‚
â”‚  IF FALSE â†’ Send error email         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
        â”‚          â”‚
       YES        NO
        â”‚          â”‚
        â†“          â†“
   [Continue]  [Error Email]
        â”‚          â”‚
        â†“          â””â”€â”€â†’ END
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NODE 4: HTTP REQUEST                â”‚
â”‚                                      â”‚
â”‚  POST http://localhost:3000/         â”‚
â”‚       api/admin/webhook-n8n          â”‚
â”‚                                      â”‚
â”‚  Headers:                            â”‚
â”‚  - Content-Type: application/json   â”‚
â”‚  - Authorization: Bearer TOKEN       â”‚
â”‚                                      â”‚
â”‚  Body:                               â”‚
â”‚  {                                   â”‚
â”‚    type: "{{ $json.type }}",        â”‚
â”‚    data: "{{ $json.validData }}",   â”‚
â”‚    cabinetId: "cab_1"               â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NODE 5: EMAIL - SUCCESS             â”‚
â”‚                                      â”‚
â”‚  To: admin@efficience.fr             â”‚
â”‚  Subject: âœ… Import RÃ©ussi          â”‚
â”‚  Body: X records importÃ©s            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
               END
```

---

## 3ï¸âƒ£ Ã‰tat des DonnÃ©es

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            AVANT L'IMPORT                           â”‚
â”‚                                                     â”‚
â”‚  patients:       5 enregistrements                 â”‚
â”‚  finances:       0 enregistrements                 â”‚
â”‚  production:     0 enregistrements                 â”‚
â”‚  appointments:   0 enregistrements                 â”‚
â”‚                                                     â”‚
â”‚  CA moyen: N/A                                     â”‚
â”‚  Patients: 5                                       â”‚
â”‚  Rendez-vous: 0                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â†“ (Click "Synchroniser")

                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  N8N Trigger â”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            APRÃˆS L'IMPORT                           â”‚
â”‚                                                     â”‚
â”‚  patients:       8 enregistrements    (+3) âœ¨     â”‚
â”‚  finances:       3 enregistrements    (+3) âœ¨     â”‚
â”‚  production:     2 enregistrements    (+2) âœ¨     â”‚
â”‚  appointments:   2 enregistrements    (+2) âœ¨     â”‚
â”‚                                                     â”‚
â”‚  CA moyen: 45000â‚¬                      âœ¨         â”‚
â”‚  Patients: 8                           âœ¨         â”‚
â”‚  Rendez-vous: 2                        âœ¨         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4ï¸âƒ£ Timeline Temporelle

```
User clicks "Sync"
â”‚
â”œâ”€ 0ms: Button disabled, loading spinner
â”‚
â”œâ”€ 50ms: POST /api/admin/trigger-sync sent
â”‚
â”œâ”€ 100ms: Backend receives request
â”‚  â”œâ”€ Validate token âœ“
â”‚  â”œâ”€ Send to N8N (optional)
â”‚  â””â”€ Return response
â”‚
â”œâ”€ 150ms: Frontend shows "Processing..."
â”‚
â”œâ”€ [N8N processes...]
â”‚  â”œâ”€ 500ms: Validate data
â”‚  â”œâ”€ 600ms: HTTP POST to Efficience
â”‚  â””â”€ 700ms: Receive response
â”‚
â”œâ”€ 750ms: MongoDB inserts data
â”‚  â”œâ”€ insertMany() in background
â”‚  â”œâ”€ Log in webhook_logs
â”‚  â””â”€ Return success
â”‚
â”œâ”€ 800ms: Frontend shows "âœ… Success"
â”‚  â”œâ”€ Display message
â”‚  â”œâ”€ Show record count
â”‚  â””â”€ Start countdown to refresh
â”‚
â”œâ”€ 2000ms: AUTO-REFRESH PAGE
â”‚  â”œâ”€ Fetch /api/stats
â”‚  â”œâ”€ Refresh dashboard
â”‚  â””â”€ User sees updated data âœ¨
â”‚
â””â”€ Done! Total: ~2 seconds
```

---

## 5ï¸âƒ£ Structure MongoDB

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          MONGODB COLLECTIONS                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£ patients
   â”œâ”€ _id: ObjectId
   â”œâ”€ nom: String
   â”œâ”€ prenom: String
   â”œâ”€ email: String
   â”œâ”€ telephone: String
   â”œâ”€ cabinetId: String
   â”œâ”€ source: "n8n-import"
   â””â”€ createdAt: Date

2ï¸âƒ£ donnees_cabinet (Finances)
   â”œâ”€ _id: ObjectId
   â”œâ”€ cabinetId: String
   â”œâ”€ periode: String (YYYY-MM)
   â”œâ”€ chiffreAffaires: Number
   â”œâ”€ revenus: Number
   â”œâ”€ depenses: Number
   â”œâ”€ source: "n8n-import"
   â””â”€ createdAt: Date

3ï¸âƒ£ production
   â”œâ”€ _id: ObjectId
   â”œâ”€ cabinetId: String
   â”œâ”€ praticien: String
   â”œâ”€ periode: String
   â”œâ”€ heures: Number
   â”œâ”€ actes: Number
   â”œâ”€ revenus: Number
   â”œâ”€ source: "n8n-import"
   â””â”€ createdAt: Date

4ï¸âƒ£ rendezvous (Appointments)
   â”œâ”€ _id: ObjectId
   â”œâ”€ cabinetId: String
   â”œâ”€ patientNom: String
   â”œâ”€ date: Date
   â”œâ”€ heure: String
   â”œâ”€ praticien: String
   â”œâ”€ type: String
   â”œâ”€ source: "n8n-import"
   â””â”€ createdAt: Date

5ï¸âƒ£ webhook_logs (Audit Trail)
   â”œâ”€ _id: ObjectId
   â”œâ”€ type: String
   â”œâ”€ cabinetId: String
   â”œâ”€ recordsProcessed: Number
   â”œâ”€ success: Boolean
   â”œâ”€ details: Object
   â””â”€ timestamp: Date
```

---

## 6ï¸âƒ£ SÃ©curitÃ©: Flux du Token

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UTILISATEUR CLIQUE "SYNC"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND ENVOIE REQUEST            â”‚
â”‚  Authorization: Bearer TOKEN        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EFFICIENCE BACKEND VÃ‰RIFIE TOKEN   â”‚
â”‚                                     â”‚
â”‚  âœ“ Header prÃ©sent?                 â”‚
â”‚  âœ“ Format Bearer?                  â”‚
â”‚  âœ“ Token valide?                   â”‚
â”‚                                     â”‚
â”‚  âŒ Rejet â†’ 401 Unauthorized       â”‚
â”‚  âœ… SuccÃ¨s â†’ Continue              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  N8N REÃ‡OIT DONNÃ‰ES                â”‚
â”‚  POST /webhook/efficience-sync     â”‚
â”‚                                     â”‚
â”‚  Valide:                            â”‚
â”‚  âœ“ Type de donnÃ©es                 â”‚
â”‚  âœ“ Colonnes requises               â”‚
â”‚  âœ“ Format des valeurs              â”‚
â”‚                                     â”‚
â”‚  âŒ Invalide â†’ Error email         â”‚
â”‚  âœ… Valide â†’ Continue              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EFFICIENCE WEBHOOK REÃ‡OIT DONNÃ‰ES  â”‚
â”‚  POST /api/admin/webhook-n8n       â”‚
â”‚                                     â”‚
â”‚  Authorization: Bearer TOKEN        â”‚
â”‚                                     â”‚
â”‚  âœ“ Token valide? (encore)          â”‚
â”‚  âœ“ DonnÃ©es valides?                â”‚
â”‚  âœ“ Insert possible?                â”‚
â”‚                                     â”‚
â”‚  âŒ ProblÃ¨me â†’ Log erreur          â”‚
â”‚  âœ… OK â†’ MongoDB insertMany()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MONGODB REÃ‡OIT DONNÃ‰ES             â”‚
â”‚                                     â”‚
â”‚  âœ“ Connexion sÃ©curisÃ©e? (MongoDB+) â”‚
â”‚  âœ“ Authentification OK? (user/pass)â”‚
â”‚  âœ“ Insert permissions OK?          â”‚
â”‚                                     â”‚
â”‚  âŒ Erreur â†’ Log webhook_logs      â”‚
â”‚  âœ… SuccÃ¨s â†’ Data persisted        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7ï¸âƒ£ ScalabilitÃ©: Charge Multiple

```
Utilisateur 1                    
â”œâ”€ Click Sync (14:35:00)        
â”‚  â””â”€ â†’ 5 patients importÃ©s     
â”‚
Utilisateur 2                   
â”œâ”€ Click Sync (14:35:02)        
â”‚  â””â”€ â†’ 3 finances importÃ©es    
â”‚
Utilisateur 3                   
â”œâ”€ Click Sync (14:35:05)        
â”‚  â””â”€ â†’ 2 production importÃ©e   

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EFFICIENCE BACKEND              â”‚
â”‚  (Handles all simultaneously)     â”‚
â”‚                                  â”‚
â”‚  Request Queue:                  â”‚
â”‚  1. User 1 â†’ Process             â”‚
â”‚  2. User 2 â†’ Process             â”‚
â”‚  3. User 3 â†’ Process             â”‚
â”‚                                  â”‚
â”‚  Async Operations:               â”‚
â”‚  All run in parallel             â”‚
â”‚  No blocking                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MONGODB                         â”‚
â”‚  (Connection Pooling)            â”‚
â”‚                                  â”‚
â”‚  Pool Size: 10 connections      â”‚
â”‚  - User 1 â†’ Connection 1        â”‚
â”‚  - User 2 â†’ Connection 2        â”‚
â”‚  - User 3 â†’ Connection 3        â”‚
â”‚  - 7 ready for next requests    â”‚
â”‚                                  â”‚
â”‚  Result: Scalable to 100+ users â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8ï¸âƒ£ RÃ©capitulatif Visual

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SYSTÃˆME COMPLET               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  ğŸ–¥ï¸  EFFICIENCE UI                             â”‚
â”‚  â”œâ”€ Admin Panel (/admin)                       â”‚
â”‚  â”œâ”€ Dashboard (/dashboard)                     â”‚
â”‚  â””â”€ Real-time Updates                          â”‚
â”‚       â”‚                                         â”‚
â”‚       â†“                                         â”‚
â”‚  âš™ï¸  EFFICIENCE BACKEND                        â”‚
â”‚  â”œâ”€ API Routes (3 endpoints)                   â”‚
â”‚  â”œâ”€ Webhook Handler                           â”‚
â”‚  â””â”€ MongoDB Integration                       â”‚
â”‚       â”‚                                         â”‚
â”‚       â†“                                         â”‚
â”‚  ğŸ”— N8N WORKFLOW                               â”‚
â”‚  â”œâ”€ Webhook Trigger                           â”‚
â”‚  â”œâ”€ Data Validation                           â”‚
â”‚  â”œâ”€ Conditional Logic                         â”‚
â”‚  â””â”€ HTTP Request                              â”‚
â”‚       â”‚                                         â”‚
â”‚       â†“                                         â”‚
â”‚  ğŸ’¾ MONGODB                                     â”‚
â”‚  â”œâ”€ 5 Collections                             â”‚
â”‚  â”œâ”€ Audit Logging                             â”‚
â”‚  â””â”€ Data Persistence                          â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Fin des diagrammes! ğŸ“Š**
